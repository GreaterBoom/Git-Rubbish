<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vditor ç¼–è¾‘å™¨ - GitRubbish</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    
    <!-- Vditor ç¼–è¾‘å™¨ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor@3.10.4/dist/index.css" />
    <script src="https://cdn.jsdelivr.net/npm/vditor@3.10.4/dist/index.min.js"></script>
    
    <style>
        /* é¢„è§ˆåŒºåŸŸæ ·å¼ */
        #preview {
            line-height: 1.6;
        }
        #preview h1, #preview h2, #preview h3 {
            font-weight: bold;
            margin: 1rem 0 0.5rem;
        }
        #preview h1 { font-size: 1.5rem; }
        #preview h2 { font-size: 1.25rem; }
        #preview h3 { font-size: 1.1rem; }
        #preview p { margin: 0.5rem 0; }
        #preview code { 
            background: #f5f5f5; 
            padding: 2px 4px; 
            border-radius: 3px; 
            font-size: 0.9em; 
        }
        #preview pre { 
            background: #1e1e1e; 
            padding: 0;
            border: 2px solid #000; 
            overflow: hidden;
            margin: 1rem 0;
            position: relative;
        }
        
        #preview pre code { 
            background: none; 
            padding: 1rem;
            display: block;
            overflow-x: auto;
            color: #d4d4d4;
        }
        
        /* ä»£ç å—è¯­è¨€æ ‡ç­¾ */
        #preview pre::before,
        #previewContent pre::before {
            content: attr(data-lang);
            position: absolute;
            top: 0;
            right: 0;
            background: #000;
            color: #fff;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 1;
        }
        
        /* é¢„è§ˆæ¨¡æ€æ¡†çš„ä»£ç å—æ ·å¼ */
        #previewContent pre {
            background: #1e1e1e;
            padding: 0;
            border: 2px solid #000;
            overflow: hidden;
            margin: 1rem 0;
            position: relative;
        }
        
        #previewContent pre code {
            background: none;
            padding: 1rem;
            display: block;
            overflow-x: auto;
            color: #d4d4d4;
        }
        
        /* Vditor ç¼–è¾‘å™¨å†…ä»£ç å—æ ·å¼ - çº¯ Markdown é£æ ¼ï¼ˆæ— æ¡†ï¼‰ */
        .vditor-ir pre {
            background: #fafafa !important;
            border: none !important;
            padding: 4px 0 !important;
            margin: 4px 0 !important;
            border-radius: 0 !important;
        }
        
        .vditor-ir pre code {
            color: #333 !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
        }
        
        /* Markdown æ ‡è®°ç¬¦å·ï¼ˆ```ï¼‰ - æ·¡åŒ–æ˜¾ç¤º */
        .vditor-ir .vditor-ir__marker--pre {
            color: #bbb !important;
            font-size: 12px !important;
            user-select: none !important;
        }
        
        /* ç¼–è¾‘å™¨æ•´ä½“èƒŒæ™¯ */
        .vditor-ir {
            background: #ffffff !important;
        }
        
        /* ç¼–è¾‘å™¨å†…çš„æ™®é€šæ–‡æœ¬ */
        .vditor-ir__node {
            line-height: 1.8 !important;
        }
        
        /* ç¼–è¾‘å™¨å†…çš„æ ‡é¢˜æ ·å¼ */
        .vditor-ir h1, .vditor-ir h2, .vditor-ir h3 {
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-top: 20px !important;
            margin-bottom: 12px !important;
        }
        
        /* ç¼–è¾‘å™¨å†…çš„å¼•ç”¨å— */
        .vditor-ir blockquote {
            border-left: 4px solid #000 !important;
            padding-left: 16px !important;
            color: #666 !important;
            margin: 12px 0 !important;
        }
        
        /* ç¼–è¾‘å™¨å†…çš„è¡Œå†…ä»£ç  */
        .vditor-ir code:not(pre code) {
            background: #f5f5f5 !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            font-size: 90% !important;
            color: #d63384 !important;
            border: 1px solid #ddd !important;
        }
        
        /* ç¼–è¾‘å™¨å†…çš„é“¾æ¥ */
        .vditor-ir a {
            color: #0066cc !important;
            text-decoration: none !important;
        }
        
        .vditor-ir a:hover {
            text-decoration: underline !important;
        }
        
        /* ç§»é™¤ç¼–è¾‘å™¨å†…å¤šä½™çš„è“è‰²çº¿æ¡ */
        .vditor-ir__node--expand::before,
        .vditor-ir__node--expand::after {
            display: none !important;
        }
        
        .vditor-ir .vditor-ir__node[data-block="0"]::before {
            display: none !important;
        }
        #preview img {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
        }
        #preview table {
            border-collapse: collapse;
            width: 100%;
            margin: 1rem 0;
        }
        #preview table th,
        #preview table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #preview table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        /* åˆ—è¡¨æ ·å¼ */
        #preview ul, #preview ol {
            margin: 0.5rem 0;
            padding-left: 2rem;
        }
        #preview ul li {
            list-style-type: disc;
            margin: 0.25rem 0;
        }
        #preview ol li {
            list-style-type: decimal;
            margin: 0.25rem 0;
        }
        #preview ul ul, #preview ol ul {
            list-style-type: circle;
        }
        #preview ul ul ul, #preview ol ul ul {
            list-style-type: square;
        }
        
        /* Vditor ç¼–è¾‘å™¨å†…çš„åˆ—è¡¨æ ·å¼ */
        .vditor-ir ol {
            list-style-type: decimal !important;
            padding-left: 2rem !important;
        }
        .vditor-ir ol li {
            list-style-type: decimal !important;
            display: list-item !important;
        }
        .vditor-ir ul {
            list-style-type: disc !important;
            padding-left: 2rem !important;
        }
        .vditor-ir ul li {
            list-style-type: disc !important;
            display: list-item !important;
        }
        
        /* ä»£ç è¯­è¨€é€‰æ‹©å™¨æ ·å¼ */
        #codeLangSelector {
            position: fixed;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            z-index: 9999;
            max-height: 500px;
            overflow-y: auto;
            min-width: 280px;
            max-width: 400px;
            animation: fadeInScale 0.2s ease-out;
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* é€‰æ‹©å™¨èƒŒæ™¯é®ç½© */
        #codeLangSelector.show::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
            animation: fadeIn 0.2s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        #codeLangSelector::-webkit-scrollbar {
            width: 10px;
        }
        
        #codeLangSelector::-webkit-scrollbar-track {
            background: #f5f5f5;
        }
        
        #codeLangSelector::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 5px;
        }
        
        #codeLangSelector::-webkit-scrollbar-thumb:hover {
            background: #000;
        }
        
        .code-lang-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .code-lang-item:hover {
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            color: #1565c0;
            padding-left: 24px;
            border-left: 3px solid #2196f3;
        }
        
        .code-lang-item:active {
            transform: scale(0.98);
            background: linear-gradient(to right, #bbdefb, #90caf9);
        }
        
        .code-lang-category {
            padding: 10px 20px;
            background: #2196f3;
            color: white;
            font-weight: bold;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        

        
        /* ========== Vditor å·¥å…·æ ç¾åŒ– ========== */
        
        /* å·¥å…·æ æ•´ä½“æ ·å¼ */
        .vditor-toolbar {
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef) !important;
            border-bottom: 2px solid #dee2e6 !important;
            padding: 10px 16px !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
            display: flex !important;
            flex-wrap: wrap !important;
            align-items: center !important;
            gap: 4px !important;
        }
        
        /* å·¥å…·æ æŒ‰é’®æ ·å¼ */
        .vditor-toolbar button,
        .vditor-toolbar .vditor-tooltipped {
            background: white !important;
            border: 1px solid #dee2e6 !important;
            border-radius: 6px !important;
            margin: 2px 2px !important;
            padding: 8px 12px !important;
            min-width: 36px !important;
            height: 36px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s ease !important;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important;
        }
        
        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .vditor-toolbar button:hover,
        .vditor-toolbar .vditor-tooltipped:hover {
            background: linear-gradient(to bottom, #e3f2fd, #bbdefb) !important;
            border-color: #2196f3 !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 3px 6px rgba(33, 150, 243, 0.2) !important;
        }
        
        /* æŒ‰é’®æ¿€æ´»çŠ¶æ€ */
        .vditor-toolbar button.vditor-toolbar--current,
        .vditor-toolbar button:active {
            background: linear-gradient(to bottom, #2196f3, #1976d2) !important;
            border-color: #1565c0 !important;
            color: white !important;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2) !important;
        }
        
        /* å·¥å…·æ å›¾æ ‡å¢å¤§ */
        .vditor-toolbar svg {
            width: 18px !important;
            height: 18px !important;
        }
        
        /* æŒ‰é’®ç»„æ ·å¼ - è®©ç›¸å…³æŒ‰é’®æ›´ç´§å‡‘ */
        .vditor-toolbar > div {
            display: inline-flex !important;
            align-items: center !important;
            gap: 2px !important;
        }
        
        /* ä¸‹æ‹‰æŒ‰é’®æ ·å¼ */
        .vditor-toolbar .vditor-tooltipped__s,
        .vditor-toolbar .vditor-tooltipped__n {
            min-width: 40px !important;
        }
        
        /* å·¥å…·æ åˆ†éš”çº¿ */
        .vditor-toolbar .vditor-toolbar__divider {
            background: linear-gradient(to bottom, transparent, #dee2e6, transparent) !important;
            margin: 0 6px !important;
            height: 28px !important;
            width: 1px !important;
            align-self: center !important;
        }
        
        /* ç¼–è¾‘å™¨å†…å®¹åŒºåŸŸ */
        .vditor-ir {
            padding: 20px !important;
            font-size: 16px !important;
            line-height: 1.8 !important;
        }
        
        /* ç¼–è¾‘å™¨ç„¦ç‚¹çŠ¶æ€ */
        .vditor:focus-within .vditor-toolbar {
            border-bottom-color: #2196f3 !important;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15) !important;
        }
        
        /* ä¸‹æ‹‰èœå•ç¾åŒ– */
        .vditor-hint,
        .vditor-panel {
            border: 2px solid #dee2e6 !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            background: white !important;
        }
        
        .vditor-hint button:hover,
        .vditor-panel button:hover {
            background: #e3f2fd !important;
        }
        
        /* éšè—ä»£ç å—æŒ‰é’®çš„ tooltip */
        .vditor-toolbar button[data-type="code-block"]::before,
        .vditor-toolbar button[data-type="code-block"]::after,
        .vditor-toolbar .vditor-tooltipped[data-type="code-block"]::before,
        .vditor-toolbar .vditor-tooltipped[data-type="code-block"]::after {
            display: none !important;
            content: none !important;
            visibility: hidden !important;
        }
        
        /* éšè—æ‰€æœ‰ç©ºçš„æˆ– undefined çš„ tooltip */
        .vditor-toolbar .vditor-tooltipped__s::before,
        .vditor-toolbar .vditor-tooltipped__s::after {
            content: attr(aria-label) !important;
        }
        
        .vditor-toolbar button[aria-label=""]::before,
        .vditor-toolbar button[aria-label=""]::after,
        .vditor-toolbar button[aria-label="undefined"]::before,
        .vditor-toolbar button[aria-label="undefined"]::after {
            display: none !important;
        }

    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- é¡¶éƒ¨æ“ä½œæ  -->
        <div class="flex items-center gap-3 mb-6 flex-wrap">
            <button onclick="history.back()" class="px-5 py-2.5 border-2 border-black font-bold hover:bg-black hover:text-white transition-all rounded-lg shadow-sm hover:shadow-md" title="è¿”å›ä¸Šä¸€é¡µ">
                â† è¿”å›
            </button>
            <input 
                type="text" 
                id="titleInput" 
                placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜..."
                class="flex-1 min-w-[300px] px-4 py-2.5 border-2 border-black text-xl font-bold focus:outline-none focus:border-blue-500 transition-all rounded-lg"
            >
            <button onclick="showPreview()" class="px-5 py-2.5 border-2 border-blue-500 text-blue-500 font-bold hover:bg-blue-500 hover:text-white transition-all rounded-lg shadow-sm hover:shadow-md">
                é¢„è§ˆ
            </button><!--

                ï¿½ï¸ ç é¢„è§ˆ
            --><button onclick="saveDraft()" class="px-5 py-2.5 border-2 border-gray-600 text-gray-600 font-bold hover:bg-gray-600 hover:text-white transition-all rounded-lg shadow-sm hover:shadow-md">
                ğŸ’¾ è‰ç¨¿
            </button>
            <button onclick="publishArticle()" class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold hover:from-blue-700 hover:to-purple-700 transition-all rounded-lg shadow-md hover:shadow-lg">
                âœ“ å‘å¸ƒ
            </button>
        </div>



        <!-- ç¼–è¾‘å™¨åŒºåŸŸ - å…¨å®½å•æ  -->
        <div class="mb-6 relative" style="height: 650px;">
            <div class="border-2 border-gray-300 rounded-xl flex flex-col h-full shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white px-5 py-3 font-bold flex items-center justify-between">
                    <span class="flex items-center gap-2">
                        <span class="text-xl">âœï¸</span>
                        <span>Markdown ç¼–è¾‘å™¨</span>
                        <span class="text-xs bg-blue-500 px-2 py-1 rounded-full">å³æ—¶æ¸²æŸ“</span>
                    </span>
                    <span class="text-sm font-normal bg-white/10 px-3 py-1 rounded-full" id="charCount">0 å­—</span>
                </div>
                <div id="vditor" class="flex-1 bg-white"></div>
            </div>
        </div>
        
        <!-- ä»£ç è¯­è¨€é€‰æ‹©å™¨ -->
        <div id="codeLangSelector" class="hidden"></div>

        <!-- æ–‡ç« è®¾ç½® -->
        <div class="border-2 border-gray-300 rounded-xl shadow-lg overflow-hidden">
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white px-6 py-3 font-bold flex items-center gap-2">
                <span class="text-xl">âš™ï¸</span>
                <span>æ–‡ç« è®¾ç½®</span>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block font-bold mb-2">ğŸ“ åˆ†ç±»</label>
                        <select id="categorySelect" class="w-full px-4 py-2 border-2 border-black focus:outline-none hover:bg-gray-50">
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <option value="æŠ€æœ¯ç¬”è®°">æŠ€æœ¯ç¬”è®°</option>
                            <option value="ä»£ç ç‰‡æ®µ">ä»£ç ç‰‡æ®µ</option>
                            <option value="é¡¹ç›®ç»éªŒ">é¡¹ç›®ç»éªŒ</option>
                            <option value="å·¥å…·æ¨è">å·¥å…·æ¨è</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block font-bold mb-2">ğŸ“ æ–‡ç« æ‘˜è¦</label>
                        <textarea 
                            id="summaryInput" 
                            placeholder="ç®€çŸ­æè¿°æ–‡ç« å†…å®¹..."
                            class="w-full px-4 py-2 border-2 border-black focus:outline-none resize-none"
                            rows="3"
                            maxlength="200"
                        ></textarea>
                        <div class="text-sm text-gray-500 mt-1" id="summaryLength">0/200</div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block font-bold mb-3">ğŸ·ï¸ æ ‡ç­¾ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰</label>
                    <div id="selectedTags" class="flex flex-wrap gap-2 mb-3 min-h-[44px] p-3 border-2 border-dashed border-gray-300 bg-gray-50"></div>
                    <div class="border-2 border-black p-4 max-h-64 overflow-y-auto bg-white">
                        <div id="availableTags" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
                
                <div>
                    <label class="block font-bold mb-3">ğŸ“ é™„ä»¶ä¸Šä¼ </label>
                    <div class="border-2 border-dashed border-gray-300 p-6 text-center bg-gray-50 hover:bg-gray-100 transition">
                    <input 
                        type="file" 
                        id="attachmentInput" 
                        accept=".zip,.rar,.7z,.tar,.gz,.java,.py,.js,.html,.css,.txt,.md,.json,.xml,.yml"
                        class="hidden"
                        onchange="handleFileSelect(event)"
                    >
                    <button 
                        type="button"
                        onclick="document.getElementById('attachmentInput').click()"
                        class="px-6 py-2 border-2 border-black font-bold hover:bg-black hover:text-white transition"
                    >
                        é€‰æ‹©æ–‡ä»¶
                    </button>
                    <p class="text-sm text-gray-500 mt-2">æ”¯æŒ .zip, .rar, .7z ç­‰å‹ç¼©åŒ…åŠä»£ç æ–‡ä»¶ï¼Œæœ€å¤§ 50MB</p>
                    
                    <div id="attachmentInfo" class="hidden mt-4 p-3 bg-gray-50 border-2 border-black">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ğŸ“¦</span>
                                <div class="text-left">
                                    <p class="font-bold" id="attachmentName"></p>
                                    <p class="text-sm text-gray-600" id="attachmentSize"></p>
                                </div>
                            </div>
                            <button 
                                type="button"
                                onclick="removeAttachment()"
                                class="px-3 py-1 border-2 border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition"
                            >
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                    
                    <div id="uploadProgress" class="hidden mt-4">
                        <div class="w-full bg-gray-200 h-2">
                            <div id="progressBar" class="bg-black h-2 transition-all" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">ä¸Šä¼ ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="previewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-4xl max-h-[90vh] flex flex-col border-4 border-black">
            <!-- é¢„è§ˆå¤´éƒ¨ -->
            <div class="flex items-center justify-between p-4 border-b-2 border-black">
                <h2 class="text-2xl font-bold">æ–‡ç« é¢„è§ˆ</h2>
                <button onclick="closePreview()" class="px-4 py-2 border-2 border-black font-bold hover:bg-black hover:text-white">
                    âœ• å…³é—­
                </button>
            </div>
            
            <!-- é¢„è§ˆå†…å®¹ -->
            <div class="flex-1 overflow-y-auto p-8">
                <!-- æ–‡ç« æ ‡é¢˜ -->
                <h1 id="previewTitle" class="text-4xl font-bold mb-4"></h1>
                
                <!-- æ–‡ç« å…ƒä¿¡æ¯ -->
                <div class="flex items-center gap-4 text-sm text-gray-600 mb-6 pb-6 border-b-2 border-gray-200">
                    <span id="previewCategory"></span>
                    <span id="previewTags"></span>
                    <span id="previewDate"></span>
                </div>
                
                <!-- æ–‡ç« æ‘˜è¦ -->
                <div id="previewSummary" class="bg-gray-50 border-l-4 border-black p-4 mb-6 italic"></div>
                
                <!-- æ–‡ç« å†…å®¹ -->
                <div id="previewContent" class="prose prose-lg max-w-none"></div>
                
                <!-- é™„ä»¶ä¿¡æ¯ -->
                <div id="previewAttachment" class="hidden mt-6 p-4 bg-gray-50 border-2 border-black">
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">ğŸ“¦</span>
                        <div>
                            <p class="font-bold">é™„ä»¶</p>
                            <p id="previewAttachmentName" class="text-sm text-gray-600"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é¢„è§ˆåº•éƒ¨æ“ä½œ -->
            <div class="flex items-center justify-between p-4 border-t-2 border-black bg-gray-50">
                <button onclick="closePreview()" class="px-6 py-3 border-2 border-black font-bold hover:bg-black hover:text-white">
                    ç»§ç»­ç¼–è¾‘
                </button>
                <div class="flex gap-3">
                    <button onclick="closePreview(); saveDraft()" class="px-6 py-3 border-2 border-black font-bold hover:bg-black hover:text-white">
                        ä¿å­˜è‰ç¨¿
                    </button>
                    <button onclick="closePreview(); publishArticle()" class="px-6 py-3 bg-black text-white font-bold hover:bg-gray-800">
                        å‘å¸ƒæ–‡ç« 
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä»£ç å—ç¼–è¾‘å¼¹çª— -->
    <div id="codeEditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-5xl max-h-[90vh] flex flex-col border-4 border-black">
            <!-- å¼¹çª—å¤´éƒ¨ -->
            <div class="flex items-center justify-between p-4 border-b-2 border-black bg-gray-50">
                <div class="flex items-center gap-4">
                    <h2 class="text-xl font-bold">ğŸ’» ä»£ç å—ç¼–è¾‘å™¨</h2>
                    <select id="codeLanguageSelect" class="px-3 py-1 border-2 border-black font-bold text-sm">
                        <option value="javascript">JavaScript</option>
                        <option value="typescript">TypeScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="csharp">C#</option>
                        <option value="go">Go</option>
                        <option value="rust">Rust</option>
                        <option value="php">PHP</option>
                        <option value="ruby">Ruby</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="sql">SQL</option>
                        <option value="bash">Bash</option>
                        <option value="json">JSON</option>
                        <option value="yaml">YAML</option>
                        <option value="markdown">Markdown</option>
                        <option value="text">çº¯æ–‡æœ¬</option>
                    </select>
                </div>
                <button onclick="closeCodeEdit()" class="px-4 py-2 border-2 border-black font-bold hover:bg-black hover:text-white">
                    âœ• å…³é—­
                </button>
            </div>
            
            <!-- ä»£ç ç¼–è¾‘åŒº -->
            <div class="flex-1 overflow-hidden">
                <textarea 
                    id="codeTextarea" 
                    class="w-full h-full p-4 font-mono text-sm resize-none focus:outline-none border-none"
                    style="font-family: 'Consolas', 'Monaco', 'Courier New', monospace; line-height: 1.6;"
                    placeholder="åœ¨æ­¤è¾“å…¥ä»£ç ..."
                ></textarea>
            </div>
            
            <!-- å¼¹çª—åº•éƒ¨æ“ä½œ -->
            <div class="flex items-center justify-between p-4 border-t-2 border-black bg-gray-50">
                <button onclick="closeCodeEdit()" class="px-6 py-2 border-2 border-black font-bold hover:bg-black hover:text-white">
                    å–æ¶ˆ
                </button>
                <button onclick="saveCodeBlock()" class="px-6 py-2 bg-black text-white font-bold hover:bg-gray-800">
                    âœ“ æ’å…¥ä»£ç 
                </button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        let articleId = null;
        let isEdit = false;
        let selectedTags = [];
        let attachmentData = null;
        let vditor = null;
        let currentCodeBlockPosition = null;
        
        // å¸¸ç”¨æ ‡ç­¾ - ä¸ä¸»é¡µå®Œå…¨ä¸€è‡´
        const commonTags = {
            'å‰ç«¯å¼€å‘': ['JavaScript', 'TypeScript', 'Vue', 'React', 'Angular', 'HTML', 'CSS', 'Tailwind', 'Bootstrap', 'Webpack', 'Vite'],
            'åç«¯å¼€å‘': ['Node.js', 'Express', 'Nest.js', 'Java', 'Spring Boot', 'Spring Cloud', 'MyBatis', 'Python', 'Django', 'Flask', 'FastAPI', 'Go', 'Gin', 'Rust'],
            'æ•°æ®åº“': ['MySQL', 'PostgreSQL', 'MongoDB', 'Redis', 'SQL', 'NoSQL'],
            'è¿ç»´éƒ¨ç½²': ['Docker', 'Kubernetes', 'CI/CD', 'Linux', 'Nginx', 'Jenkins'],
            'åµŒå…¥å¼': ['åµŒå…¥å¼', 'STM32', 'Arduino', 'ESP32', 'ESP8266', '51å•ç‰‡æœº', 'AVR', 'ARM', 'Cortex-M', 'FreeRTOS', 'RT-Thread', 'HALåº“', 'Keil', 'IAR'],
            'ç‰©è”ç½‘': ['ç‰©è”ç½‘', 'IoT', 'MQTT', 'CoAP', 'LoRaWAN', 'NB-IoT', 'Zigbee', 'Bluetooth', 'æ™ºèƒ½å®¶å±…', 'ä¼ æ„Ÿå™¨', 'è¾¹ç¼˜è®¡ç®—'],
            'é€šç”¨æŠ€èƒ½': ['Git', 'ç®—æ³•', 'æ•°æ®ç»“æ„', 'è®¾è®¡æ¨¡å¼', 'å¾®æœåŠ¡', 'æ€§èƒ½ä¼˜åŒ–', 'å®‰å…¨', 'æµ‹è¯•', 'å‰ç«¯', 'åç«¯', 'å…¨æ ˆ']
        };

        window.onload = function() {
            if (!requireLogin()) return;
            
            articleId = getUrlParam('id');
            isEdit = !!articleId;
            
            // åˆå§‹åŒ– Vditor
            initVditor();
            
            if (isEdit) {
                loadArticle();
            }
            
            // æ‘˜è¦å­—æ•°ç»Ÿè®¡
            document.getElementById('summaryInput').addEventListener('input', (e) => {
                document.getElementById('summaryLength').textContent = `${e.target.value.length}/200`;
            });
            
            // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©å™¨
            renderAvailableTags();
        };

        // åˆå§‹åŒ– Vditor
        function initVditor() {
            vditor = new Vditor('vditor', {
                height: '100%',
                mode: 'ir', // å³æ—¶æ¸²æŸ“æ¨¡å¼
                placeholder: 'å¼€å§‹å†™ä½œ... æ”¯æŒ Markdown è¯­æ³•\n\nå¯ä»¥ç›´æ¥ç²˜è´´å›¾ç‰‡ï¼Œæˆ–ç‚¹å‡»å·¥å…·æ çš„å›¾ç‰‡æŒ‰é’®ä¸Šä¼ ',
                theme: 'classic',
                icon: 'ant',
                toolbar: [
                    'emoji',
                    'headings',
                    'bold',
                    'italic',
                    'strike',
                    '|',
                    'line',
                    'quote',
                    'list',
                    'ordered-list',
                    'check',
                    '|',
                    {
                        name: 'code-block',
                        tip: '',
                        className: 'right',
                        icon: '<svg><use xlink:href="#vditor-icon-code"></use></svg>',
                        click() {
                            showCodeLanguageSelector();
                        }
                    },
                    'inline-code',
                    '|',
                    'upload', // å›¾ç‰‡ä¸Šä¼ 
                    'link',
                    'table',
                    '|',
                    'undo',
                    'redo',
                    '|',
                    'fullscreen',
                    'help'
                ],
                preview: {
                    hljs: {
                        style: 'github'
                    }
                },
                hint: {
                    parse: false
                },
                counter: {
                    enable: true
                },
                upload: {
                    accept: 'image/*',
                    url: API_BASE_URL + '/file/upload-image',
                    fieldName: 'file',
                    max: 10 * 1024 * 1024, // 10MB
                    format(files, responseText) {
                        // å¤„ç†ä¸Šä¼ å“åº”
                        try {
                            const response = JSON.parse(responseText);
                            if (response.code === 200) {
                                const data = response.data;
                                return JSON.stringify({
                                    code: 0,
                                    data: {
                                        errFiles: [],
                                        succMap: {
                                            [data.originalFilename]: API_BASE_URL + data.url
                                        }
                                    }
                                });
                            } else {
                                return JSON.stringify({
                                    code: 1,
                                    msg: response.message || 'ä¸Šä¼ å¤±è´¥'
                                });
                            }
                        } catch (error) {
                            console.error('è§£æä¸Šä¼ å“åº”å¤±è´¥:', error);
                            return JSON.stringify({
                                code: 1,
                                msg: 'ä¸Šä¼ å¤±è´¥'
                            });
                        }
                    },
                    error(msg) {
                        showMessage('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + msg, 'error');
                    },
                    success(editor, msg) {
                        console.log('ä¸Šä¼ æˆåŠŸ:', msg);
                    }
                },
                input: (value) => {
                    // å®æ—¶æ›´æ–°å­—æ•°ç»Ÿè®¡
                    updateCharCount(value);
                },
                after: () => {
                    console.log('Vditor åˆå§‹åŒ–å®Œæˆ');
                    
                    // ç§»é™¤ä»£ç å—æŒ‰é’®çš„ tooltip å±æ€§ï¼Œé˜²æ­¢æ˜¾ç¤º undefined
                    setTimeout(() => {
                        const codeBlockBtn = document.querySelector('.vditor-toolbar button[data-type="code-block"]');
                        if (codeBlockBtn) {
                            codeBlockBtn.removeAttribute('aria-label');
                            codeBlockBtn.classList.remove('vditor-tooltipped', 'vditor-tooltipped__s');
                        }
                    }, 100);
                }
            });
        }
        

        
        // æ›´æ–°å­—æ•°ç»Ÿè®¡
        function updateCharCount(content) {
            const count = content ? content.length : 0;
            const charCountEl = document.getElementById('charCount');
            if (charCountEl) {
                charCountEl.textContent = `${count} å­—`;
            }
        }

        // åŠ è½½æ–‡ç« ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
        async function loadArticle() {
            try {
                const response = await axios.get(`${API_BASE_URL}/article/detail`, {
                    params: { id: articleId }
                });
                
                if (response.data.code === 200) {
                    const article = response.data.data;
                    document.getElementById('titleInput').value = article.title || '';
                    
                    // è®¾ç½®ç¼–è¾‘å™¨å†…å®¹
                    if (vditor) {
                        vditor.setValue(article.content || '');
                    }
                    
                    document.getElementById('categorySelect').value = article.category || '';
                    document.getElementById('summaryInput').value = article.summary || '';
                    
                    // åŠ è½½æ ‡ç­¾
                    if (article.tags) {
                        selectedTags = article.tags.split(',').map(t => t.trim()).filter(t => t);
                        renderSelectedTags();
                        renderAvailableTags();
                    }
                    
                    // åŠ è½½é™„ä»¶ä¿¡æ¯
                    if (article.attachmentUrl && article.attachmentName) {
                        attachmentData = {
                            url: article.attachmentUrl,
                            originalFilename: article.attachmentName
                        };
                        showAttachmentInfo(article.attachmentName, 0);
                        document.getElementById('attachmentSize').textContent = 'å·²ä¸Šä¼ ';
                    }
                }
            } catch (error) {
                showMessage('åŠ è½½æ–‡ç« å¤±è´¥', 'error');
            }
        }
        
        // æ¸²æŸ“å¯é€‰æ ‡ç­¾
        function renderAvailableTags() {
            const container = document.getElementById('availableTags');
            if (!container) return;
            
            let html = '';
            
            for (const [category, tags] of Object.entries(commonTags)) {
                html += `
                    <div class="w-full mb-3">
                        <div class="text-xs font-bold text-gray-600 mb-2">${category}</div>
                        <div class="flex flex-wrap gap-2">
                            ${tags.map(tag => {
                                const isSelected = selectedTags.includes(tag);
                                return `
                                    <button type="button" class="cursor-pointer px-3 py-1 border border-black text-sm hover:bg-black hover:text-white transition ${isSelected ? 'bg-black text-white' : 'bg-white'}" 
                                          onclick="toggleTag('${tag}')">
                                        ${tag}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // åˆ‡æ¢æ ‡ç­¾é€‰æ‹©
        function toggleTag(tag) {
            const index = selectedTags.indexOf(tag);
            if (index > -1) {
                selectedTags.splice(index, 1);
            } else {
                selectedTags.push(tag);
            }
            renderSelectedTags();
            renderAvailableTags();
        }
        
        // æ¸²æŸ“å·²é€‰æ ‡ç­¾
        function renderSelectedTags() {
            const container = document.getElementById('selectedTags');
            if (!container) return;
            
            if (selectedTags.length === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">æœªé€‰æ‹©æ ‡ç­¾</span>';
            } else {
                container.innerHTML = selectedTags.map(tag => {
                    return `
                        <button type="button" class="px-3 py-1 bg-black text-white text-sm font-medium cursor-pointer hover:bg-gray-700 transition" onclick="toggleTag('${tag}')">
                            ${tag} Ã—
                        </button>
                    `;
                }).join('');
            }
        }

        // ä¿å­˜è‰ç¨¿
        async function saveDraft() {
            await saveArticle(0);
        }

        // å‘å¸ƒæ–‡ç« 
        async function publishArticle() {
            await saveArticle(1);
        }

        // ä¿å­˜æ–‡ç« 
        async function saveArticle(status) {
            const title = document.getElementById('titleInput').value.trim();
            const content = vditor ? vditor.getValue() : '';
            const category = document.getElementById('categorySelect').value;
            const tags = selectedTags.join(',');
            const summary = document.getElementById('summaryInput').value.trim();
            
            if (!title) {
                showMessage('è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜', 'error');
                return;
            }
            
            if (!content) {
                showMessage('è¯·è¾“å…¥æ–‡ç« å†…å®¹', 'error');
                return;
            }
            
            try {
                const data = {
                    title,
                    content,
                    category,
                    tags,
                    summary,
                    status
                };
                
                // æ·»åŠ é™„ä»¶ä¿¡æ¯
                if (attachmentData) {
                    data.attachmentUrl = attachmentData.url;
                    data.attachmentName = attachmentData.originalFilename;
                }
                
                if (isEdit) {
                    data.id = articleId;
                }
                
                const response = await axios.post(`${API_BASE_URL}/article`, data);
                
                if (response.data.code === 200) {
                    showMessage(status === 0 ? 'è‰ç¨¿ä¿å­˜æˆåŠŸ' : 'æ–‡ç« å‘å¸ƒæˆåŠŸï¼ğŸ‰', 'success');
                    setTimeout(() => {
                        if (status === 1) {
                            window.location.href = 'index.html';
                        } else {
                            window.location.href = 'profile.html';
                        }
                    }, 1500);
                }
            } catch (error) {
                showMessage('ä¿å­˜å¤±è´¥', 'error');
            }
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = 50 * 1024 * 1024;
            if (file.size > maxSize) {
                showMessage('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 50MB', 'error');
                event.target.value = '';
                return;
            }
            
            document.getElementById('uploadProgress').classList.remove('hidden');
            document.getElementById('attachmentInfo').classList.add('hidden');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await axios.post(`${API_BASE_URL}/file/upload`, formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    },
                    onUploadProgress: (progressEvent) => {
                        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);
                        document.getElementById('progressBar').style.width = percentCompleted + '%';
                    }
                });
                
                if (response.data.code === 200) {
                    attachmentData = response.data.data;
                    showAttachmentInfo(file.name, file.size);
                    showMessage('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ', 'success');
                } else {
                    showMessage(response.data.message || 'ä¸Šä¼ å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('ä¸Šä¼ å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸Šä¼ å¤±è´¥', 'error');
            } finally {
                document.getElementById('uploadProgress').classList.add('hidden');
                document.getElementById('progressBar').style.width = '0%';
                event.target.value = '';
            }
        }
        
        // æ˜¾ç¤ºé™„ä»¶ä¿¡æ¯
        function showAttachmentInfo(name, size) {
            document.getElementById('attachmentName').textContent = name;
            document.getElementById('attachmentSize').textContent = formatFileSize(size);
            document.getElementById('attachmentInfo').classList.remove('hidden');
        }
        
        // ç§»é™¤é™„ä»¶
        function removeAttachment() {
            if (confirm('ç¡®å®šè¦åˆ é™¤é™„ä»¶å—ï¼Ÿ')) {
                attachmentData = null;
                document.getElementById('attachmentInfo').classList.add('hidden');
                document.getElementById('attachmentInput').value = '';
                showMessage('é™„ä»¶å·²ç§»é™¤', 'success');
            }
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview() {
            const title = document.getElementById('titleInput').value.trim();
            const content = vditor ? vditor.getValue() : '';
            const category = document.getElementById('categorySelect').value;
            const tags = selectedTags.join(', ');
            const summary = document.getElementById('summaryInput').value.trim();
            
            // éªŒè¯
            if (!title) {
                showMessage('è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜', 'error');
                return;
            }
            
            if (!content) {
                showMessage('è¯·è¾“å…¥æ–‡ç« å†…å®¹', 'error');
                return;
            }
            
            // è®¾ç½®é¢„è§ˆå†…å®¹
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewCategory').textContent = category ? `ğŸ“ ${category}` : '';
            document.getElementById('previewTags').textContent = tags ? `ğŸ·ï¸ ${tags}` : '';
            document.getElementById('previewDate').textContent = `ğŸ“… ${new Date().toLocaleDateString('zh-CN')}`;
            
            // è®¾ç½®æ‘˜è¦
            if (summary) {
                document.getElementById('previewSummary').textContent = summary;
                document.getElementById('previewSummary').classList.remove('hidden');
            } else {
                document.getElementById('previewSummary').classList.add('hidden');
            }
            
            // æ¸²æŸ“ Markdown å†…å®¹
            if (vditor) {
                const html = vditor.getHTML();
                const previewContent = document.getElementById('previewContent');
                previewContent.innerHTML = html;
                
                // ä¸ºä»£ç å—æ·»åŠ è¯­è¨€æ ‡ç­¾
                const codeBlocks = previewContent.querySelectorAll('pre code');
                codeBlocks.forEach(code => {
                    const pre = code.parentElement;
                    const className = code.className;
                    
                    // æå–è¯­è¨€ç±»å‹
                    const langMatch = className.match(/language-(\w+)/);
                    if (langMatch) {
                        const lang = langMatch[1];
                        pre.setAttribute('data-lang', lang);
                    } else {
                        pre.setAttribute('data-lang', 'code');
                    }
                });
            }
            
            // æ˜¾ç¤ºé™„ä»¶ä¿¡æ¯
            if (attachmentData) {
                document.getElementById('previewAttachmentName').textContent = attachmentData.originalFilename;
                document.getElementById('previewAttachment').classList.remove('hidden');
            } else {
                document.getElementById('previewAttachment').classList.add('hidden');
            }
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('previewModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // å…³é—­é¢„è§ˆ
        function closePreview() {
            document.getElementById('previewModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // ESC é”®å…³é—­é¢„è§ˆå’Œä»£ç ç¼–è¾‘
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePreview();
                closeCodeEdit();
                hideCodeLanguageSelector();
            }
        });
        

        // æ‰“å¼€ä»£ç å—ç¼–è¾‘å¼¹çª—
        function openCodeEdit(code = '', language = 'javascript') {
            document.getElementById('codeTextarea').value = code;
            document.getElementById('codeLanguageSelect').value = language;
            document.getElementById('codeEditModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            document.getElementById('codeTextarea').focus();
        }
        
        // å…³é—­ä»£ç å—ç¼–è¾‘å¼¹çª—
        function closeCodeEdit() {
            document.getElementById('codeEditModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            currentCodeBlockPosition = null;
        }
        
        // ä¿å­˜ä»£ç å—
        function saveCodeBlock() {
            const code = document.getElementById('codeTextarea').value;
            const language = document.getElementById('codeLanguageSelect').value;
            
            if (!code.trim()) {
                showMessage('è¯·è¾“å…¥ä»£ç å†…å®¹', 'error');
                return;
            }
            
            // æ„å»º Markdown ä»£ç å—
            const codeBlock = `\`\`\`${language}\n${code}\n\`\`\`\n\n`;
            
            // æ’å…¥åˆ°ç¼–è¾‘å™¨
            if (vditor) {
                try {
                    // ä½¿ç”¨ insertValue æ–¹æ³•åœ¨å…‰æ ‡ä½ç½®æ’å…¥å†…å®¹
                    vditor.insertValue(codeBlock);
                    showMessage('ä»£ç å—å·²æ’å…¥', 'success');
                } catch (error) {
                    console.error('æ’å…¥ä»£ç å—å¤±è´¥:', error);
                    // å¦‚æœ insertValue ä¸å¯ç”¨ï¼Œä½¿ç”¨ setValue è¿½åŠ åˆ°æœ«å°¾
                    const currentValue = vditor.getValue();
                    vditor.setValue(currentValue + '\n' + codeBlock);
                    showMessage('ä»£ç å—å·²æ·»åŠ åˆ°æœ«å°¾', 'success');
                }
            }
            
            closeCodeEdit();
        }
        
        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä»£ç è¯­è¨€é€‰æ‹©å™¨
        document.addEventListener('click', function(e) {
            const selector = document.getElementById('codeLangSelector');
            if (selector && !selector.contains(e.target) && !e.target.closest('.vditor-toolbar')) {
                hideCodeLanguageSelector();
            }
        });
        
        // æ˜¾ç¤ºä»£ç è¯­è¨€é€‰æ‹©å™¨
        function showCodeLanguageSelector() {
            const selector = document.getElementById('codeLangSelector');
            if (!selector) return;
            
            // ä»£ç è¯­è¨€åˆ—è¡¨ï¼ˆæŒ‰åˆ†ç±»ï¼‰
            const languages = {
                'å‰ç«¯å¼€å‘': [
                    { name: 'JavaScript', value: 'javascript' },
                    { name: 'TypeScript', value: 'typescript' },
                    { name: 'HTML', value: 'html' },
                    { name: 'CSS', value: 'css' },
                    { name: 'Vue', value: 'vue' },
                    { name: 'React JSX', value: 'jsx' }
                ],
                'åç«¯å¼€å‘': [
                    { name: 'Java', value: 'java' },
                    { name: 'Python', value: 'python' },
                    { name: 'Go', value: 'go' },
                    { name: 'Rust', value: 'rust' },
                    { name: 'C', value: 'c' },
                    { name: 'C++', value: 'cpp' },
                    { name: 'C#', value: 'csharp' },
                    { name: 'PHP', value: 'php' },
                    { name: 'Ruby', value: 'ruby' },
                    { name: 'Swift', value: 'swift' },
                    { name: 'Kotlin', value: 'kotlin' },
                    { name: 'Scala', value: 'scala' }
                ],
                'æ•°æ®åº“': [
                    { name: 'SQL', value: 'sql' },
                    { name: 'MySQL', value: 'mysql' },
                    { name: 'PostgreSQL', value: 'postgresql' }
                ],
                'è„šæœ¬ä¸é…ç½®': [
                    { name: 'Bash', value: 'bash' },
                    { name: 'Shell', value: 'shell' },
                    { name: 'PowerShell', value: 'powershell' },
                    { name: 'JSON', value: 'json' },
                    { name: 'YAML', value: 'yaml' },
                    { name: 'XML', value: 'xml' },
                    { name: 'TOML', value: 'toml' }
                ],
                'è¿ç»´ä¸å·¥å…·': [
                    { name: 'Dockerfile', value: 'dockerfile' },
                    { name: 'Nginx', value: 'nginx' },
                    { name: 'Apache', value: 'apache' },
                    { name: 'Makefile', value: 'makefile' }
                ],
                'å…¶ä»–': [
                    { name: 'Markdown', value: 'markdown' },
                    { name: 'çº¯æ–‡æœ¬', value: 'plaintext' },
                    { name: 'Diff', value: 'diff' }
                ]
            };
            
            // ç”Ÿæˆé€‰æ‹©å™¨å†…å®¹
            let html = '';
            for (const [category, langs] of Object.entries(languages)) {
                html += `<div class="code-lang-category">${category}</div>`;
                langs.forEach(lang => {
                    html += `<div class="code-lang-item" onclick="insertCodeBlock('${lang.value}')">${lang.name}</div>`;
                });
            }
            
            selector.innerHTML = html;
            
            // å®šä½é€‰æ‹©å™¨ï¼ˆåœ¨ç¼–è¾‘å™¨ä¸­é—´ï¼‰
            const editorRect = document.getElementById('vditor').getBoundingClientRect();
            selector.style.left = (editorRect.left + editorRect.width / 2 - 100) + 'px';
            selector.style.top = (editorRect.top + 100) + 'px';
            
            selector.classList.remove('hidden');
            selector.classList.add('show');
        }
        
        // éšè—ä»£ç è¯­è¨€é€‰æ‹©å™¨
        function hideCodeLanguageSelector() {
            const selector = document.getElementById('codeLangSelector');
            if (selector) {
                selector.classList.add('hidden');
                selector.classList.remove('show');
            }
        }
        
        // æ’å…¥ä»£ç å—
        function insertCodeBlock(language) {
            if (vditor) {
                // æ’å…¥ç®€æ´çš„ä»£ç å—æ ¼å¼
                const codeBlock = `\n\`\`\`${language}\n\n\`\`\`\n`;
                vditor.insertValue(codeBlock);
                
                // å»¶è¿Ÿèšç„¦ï¼Œè®© Vditor å®Œæˆæ¸²æŸ“
                setTimeout(() => {
                    vditor.focus();
                    
                    // å°è¯•å°†å…‰æ ‡å®šä½åˆ°ä»£ç å—å†…éƒ¨
                    const textarea = document.querySelector('.vditor-ir .vditor-ir__preview');
                    if (textarea) {
                        // è§¦å‘ä¸€æ¬¡ç‚¹å‡»ï¼Œæ¿€æ´»ç¼–è¾‘åŒºåŸŸ
                        const event = new MouseEvent('click', {
                            bubbles: true,
                            cancelable: true,
                            view: window
                        });
                        textarea.dispatchEvent(event);
                    }
                }, 100);
            }
            hideCodeLanguageSelector();
        }
        

    </script>
</body>
</html>
