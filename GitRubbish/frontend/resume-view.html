<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç®€å† - GitRubbish</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold" id="pageTitle">æˆ‘çš„ç®€å†</h1>
            <div class="flex gap-3">
                <button id="backBtn" onclick="goBack()" class="px-4 py-2 border-2 border-black font-bold hover:bg-black hover:text-white">
                    è¿”å›
                </button>
                <button id="editBtn" onclick="window.location.href='resume-edit.html'" class="px-6 py-2 bg-black text-white font-bold hover:bg-gray-800">
                    ç¼–è¾‘ç®€å†
                </button>
            </div>
        </div>

        <div id="resumeContent" class="bg-white p-8 border-2 border-black">
            <div class="text-center text-gray-500 py-12">
                åŠ è½½ä¸­...
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        let userId = null;

        let isOwnResume = false; // æ ‡è®°æ˜¯å¦æ˜¯æŸ¥çœ‹è‡ªå·±çš„ç®€å†

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            userId = urlParams.get('userId');
            
            if (!userId) {
                // æŸ¥çœ‹è‡ªå·±çš„ç®€å†
                if (!requireLogin()) return;
                const userInfo = getCurrentUser();
                userId = userInfo.id;
                isOwnResume = true;
            } else {
                // æŸ¥çœ‹ä»–äººç®€å†
                const userInfo = getCurrentUser();
                isOwnResume = userInfo && userInfo.id == userId;
                
                if (!isOwnResume) {
                    // æŸ¥çœ‹ä»–äººç®€å†ï¼Œéšè—ç¼–è¾‘æŒ‰é’®ï¼Œä¿®æ”¹æ ‡é¢˜
                    document.getElementById('editBtn').style.display = 'none';
                    document.getElementById('pageTitle').textContent = 'TAçš„ç®€å†';
                }
            }
            
            loadResume();
        };
        
        // è¿”å›æŒ‰é’®é€»è¾‘
        function goBack() {
            if (isOwnResume) {
                // è¿”å›è‡ªå·±çš„ä¸ªäººä¸»é¡µ
                window.location.href = 'profile.html';
            } else {
                // è¿”å›å¯¹æ–¹çš„ä¸ªäººä¸»é¡µ
                window.location.href = `user-profile.html?userId=${userId}`;
            }
        }

        async function loadResume() {
            try {
                const response = await axios.get(`${API_BASE_URL}/resume?userId=${userId}`);
                if (response.data.code === 200 && response.data.data) {
                    renderResume(response.data.data);
                } else {
                    // ç®€å†ä¸å­˜åœ¨
                    if (isOwnResume) {
                        // è‡ªå·±çš„ç®€å†ä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºåˆ›å»ºæŒ‰é’®
                        document.getElementById('resumeContent').innerHTML = `
                            <div class="text-center py-12">
                                <p class="text-gray-500 mb-4">è¿˜æ²¡æœ‰åˆ›å»ºç®€å†</p>
                                <button onclick="window.location.href='resume-edit.html'" class="px-6 py-2 bg-black text-white font-bold hover:bg-gray-800">
                                    åˆ›å»ºç®€å†
                                </button>
                            </div>
                        `;
                    } else {
                        // ä»–äººç®€å†ä¸å­˜åœ¨
                        document.getElementById('resumeContent').innerHTML = `
                            <div class="text-center py-12">
                                <p class="text-gray-500">è¯¥ç”¨æˆ·è¿˜æ²¡æœ‰åˆ›å»ºç®€å†</p>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                document.getElementById('resumeContent').innerHTML = `
                    <div class="text-center text-red-500 py-12">
                        åŠ è½½å¤±è´¥
                    </div>
                `;
            }
        }

        function renderResume(resume) {
            const skills = resume.skills ? JSON.parse(resume.skills) : [];
            const experiences = resume.experience ? JSON.parse(resume.experience) : [];
            const educations = resume.education ? JSON.parse(resume.education) : [];
            const projects = resume.projects ? JSON.parse(resume.projects) : [];

            let html = `
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="text-center mb-8 pb-8 border-b-2 border-gray-200">
                    <h1 class="text-4xl font-bold mb-2">${resume.name || 'æœªå¡«å†™'}</h1>
                    <p class="text-xl text-gray-600 mb-4">${resume.title || 'æœªå¡«å†™èŒä½'}</p>
                    <div class="flex flex-wrap justify-center gap-4 text-sm">
                        ${resume.email ? `<span>ğŸ“§ ${resume.email}</span>` : ''}
                        ${resume.phone ? `<span>ğŸ“± ${resume.phone}</span>` : ''}
                        ${resume.location ? `<span>ğŸ“ ${resume.location}</span>` : ''}
                        ${resume.github ? `<span><a href="${resume.github}" target="_blank" class="text-blue-600 hover:underline">ğŸ”— GitHub</a></span>` : ''}
                    </div>
                </div>

                <!-- ä¸ªäººç®€ä»‹ -->
                ${resume.summary ? `
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-1 h-6 bg-black"></span>
                        ä¸ªäººç®€ä»‹
                    </h2>
                    <p class="text-gray-700 leading-relaxed">${resume.summary}</p>
                </div>
                ` : ''}

                <!-- æŠ€èƒ½ -->
                ${skills.length > 0 ? `
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-1 h-6 bg-black"></span>
                        æŠ€èƒ½
                    </h2>
                    <div class="flex flex-wrap gap-2">
                        ${skills.map(skill => `<span class="px-4 py-2 bg-gray-100 border-2 border-black font-medium">${skill}</span>`).join('')}
                    </div>
                </div>
                ` : ''}

                <!-- å·¥ä½œç»å† -->
                ${experiences.length > 0 ? `
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-1 h-6 bg-black"></span>
                        å·¥ä½œç»å†
                    </h2>
                    ${experiences.map(exp => `
                        <div class="mb-6 pl-4 border-l-4 border-gray-300">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="text-xl font-bold">${exp.company}</h3>
                                    <p class="text-gray-600">${exp.position}</p>
                                </div>
                                <span class="text-sm text-gray-500">${exp.period}</span>
                            </div>
                            <p class="text-gray-700 whitespace-pre-line">${exp.description}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <!-- æ•™è‚²ç»å† -->
                ${educations.length > 0 ? `
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-1 h-6 bg-black"></span>
                        æ•™è‚²ç»å†
                    </h2>
                    ${educations.map(edu => `
                        <div class="mb-4 pl-4 border-l-4 border-gray-300">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-xl font-bold">${edu.school}</h3>
                                    <p class="text-gray-600">${edu.degree} Â· ${edu.major}</p>
                                </div>
                                <span class="text-sm text-gray-500">${edu.period}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <!-- é¡¹ç›®ç»å† -->
                ${projects.length > 0 ? `
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-1 h-6 bg-black"></span>
                        é¡¹ç›®ç»å†
                    </h2>
                    ${projects.map(proj => `
                        <div class="mb-6 pl-4 border-l-4 border-gray-300">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="text-xl font-bold">${proj.name}</h3>
                                    <p class="text-gray-600">${proj.role}</p>
                                </div>
                                <span class="text-sm text-gray-500">${proj.period}</span>
                            </div>
                            ${proj.tech ? `<p class="text-sm text-gray-600 mb-2"><strong>æŠ€æœ¯æ ˆï¼š</strong>${proj.tech}</p>` : ''}
                            <p class="text-gray-700 whitespace-pre-line">${proj.description}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;

            document.getElementById('resumeContent').innerHTML = html;
        }
    </script>
</body>
</html>
